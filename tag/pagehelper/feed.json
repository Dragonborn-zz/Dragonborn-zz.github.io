{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dragonborn-zz's个人博客 • All posts by \"pagehelper\" tag",
    "description": "",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2024/02/06/java/%E5%AF%B9PageHelper%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B0%81%E8%A3%85/",
            "url": "http://example.com/2024/02/06/java/%E5%AF%B9PageHelper%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B0%81%E8%A3%85/",
            "title": "对PageHelper使用的封装",
            "date_published": "2024-02-06T09:27:01.000Z",
            "content_html": "<h2 id=\"1-问题点\"><a class=\"markdownIt-Anchor\" href=\"#1-问题点\">#</a> 1. 问题点</h2>\n<p>在使用 PageHelper 的过程中，产生了两个问题</p>\n<ul>\n<li>\n<ol>\n<li>一个分页接口点击下一页时，绝大多数的情况下数据总数是不变的，但却需要每次请求去查询统计数据总数，产生了性能浪费.</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>实际使用中要实现分页要写两步，先在要执行分页的代码前标注 <code>PageHelper.startPage(vo);</code> , 再在返回数据时使用 <code>PageInfo.of(list)</code>  生成分页对象，步骤略微麻烦.</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"2-代码\"><a class=\"markdownIt-Anchor\" href=\"#2-代码\">#</a> 2. 代码</h2>\n<p>分页参数基础类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.china315net.common.vo;<br><br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.Data;<br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-keyword\">static</span> com.china315net.common.constant.ConstantPool.MAX_PAGE_SIZE;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 基本分页对象</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BasePageVO</span> &#123;<br>    <span class=\"hljs-meta\">@ApiModelProperty(value = &quot;当前页&quot;)</span><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">pageNum</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty(value = &quot;当页显示条数&quot;)</span><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">pageSize</span> <span class=\"hljs-operator\">=</span>  <span class=\"hljs-number\">10</span>;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty(value = &quot;总页数&quot;)</span><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">totalRow</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">setPageSize</span><span class=\"hljs-params\">(Integer pageSize)</span> &#123;<br>        <span class=\"hljs-keyword\">if</span> (pageSize &gt; MAX_PAGE_SIZE) &#123;<br>            <span class=\"hljs-built_in\">this</span>.pageSize = MAX_PAGE_SIZE;<br>            <span class=\"hljs-keyword\">return</span>;<br>        &#125;<br>        <span class=\"hljs-built_in\">this</span>.pageSize = pageSize;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>分页工具类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.china315net.mybatis.util;<br><br><span class=\"hljs-keyword\">import</span> com.china315net.common.vo.BasePageVO;<br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.ISelect;<br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageHelper;<br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageInfo;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><span class=\"hljs-keyword\">import</span> java.util.function.Function;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PageUtil</span> &#123;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> &lt;T, P <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BasePageVO</span>&gt; PageInfo&lt;T&gt; <span class=\"hljs-title function_\">doPage</span><span class=\"hljs-params\">(P param, Function&lt;P,List&lt;T&gt;&gt; function)</span> &#123;<br>        <span class=\"hljs-type\">ISelect</span> <span class=\"hljs-variable\">select</span> <span class=\"hljs-operator\">=</span> () -&gt; function.apply(param);<br>        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">total</span> <span class=\"hljs-operator\">=</span> param.getTotalRow();<br>        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">pageNum</span> <span class=\"hljs-operator\">=</span> param.getPageNum();<br>        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">pageSize</span> <span class=\"hljs-operator\">=</span> param.getPageSize();<br>        PageInfo&lt;T&gt; pageInfo;<br>        <span class=\"hljs-comment\">//最后一页强制触发分页条件</span><br>        <span class=\"hljs-keyword\">if</span> (pageNum*pageSize &gt;= total) &#123;<br>            pageInfo = PageHelper.startPage(param).doSelectPageInfo(select);<br>        &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>            pageInfo = PageHelper.startPage(param).setCount(<span class=\"hljs-literal\">false</span>).doSelectPageInfo(select);<br>            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">nowTotal</span> <span class=\"hljs-operator\">=</span> (pageNum-<span class=\"hljs-number\">1</span>)*pageSize + pageInfo.getSize();<br>            <span class=\"hljs-comment\">//当前页未满且不是最后一页,设置数据总数为当前数据总数</span><br>            <span class=\"hljs-keyword\">if</span> (pageNum*pageSize &gt; nowTotal) &#123;<br>                total = nowTotal;<br>            &#125;<br>            pageInfo.setTotal(total);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> pageInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h2 id=\"3-使用\"><a class=\"markdownIt-Anchor\" href=\"#3-使用\">#</a> 3. 使用</h2>\n<p>使用的示例代码如下</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs less\"><span class=\"hljs-variable\">@ApiOperation</span>(value = <span class=\"hljs-string\">&quot;列表查询&quot;</span>)<br><span class=\"hljs-variable\">@GetMapping</span>(<span class=\"hljs-string\">&quot;/list&quot;</span>)<br>public ResultBean&lt;PageInfo&lt;BlendingFormulaVO&gt;&gt; <span class=\"hljs-built_in\">list</span>(BlendingFormulaSearchVO search) &#123;<br>    <span class=\"hljs-selector-tag\">return</span> <span class=\"hljs-selector-tag\">ResultBean</span><span class=\"hljs-selector-class\">.success</span>(PageUtil.<span class=\"hljs-built_in\">doPage</span>(search, <span class=\"hljs-attribute\">blendingFormulaService</span>::listPage));<br>&#125;<br></code></pre></td></tr></table></figure>\n<h2 id=\"4-工具类效果\"><a class=\"markdownIt-Anchor\" href=\"#4-工具类效果\">#</a> 4. 工具类效果</h2>\n<ul>\n<li>\n<ol>\n<li>当前页为最后一页强制触发查询数据总数</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>当前页未满时说明数据库数据总数为当前分页计算出的数据总数，设置数据总数为当前当前分页计算出数据总数</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>不满足上面两条且前端传了分页总数的情况，不会去查询数据总数</li>\n</ol>\n</li>\n</ul>\n",
            "tags": [
                "PageHelper"
            ]
        }
    ]
}